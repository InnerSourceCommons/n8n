{
  "name": "ISC - Crier",
  "nodes": [
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.query.channel }}",
          "mode": "name"
        },
        "messageType": "block",
        "blocksUi": "={\n\t\"blocks\": [\n\t\t{\n\t\t\t\"type\": \"section\",\n\t\t\t\"text\": {\n\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\"text\": \"<!here> Reminder: ISPO Working Group call happens {{ $json.utcDate.dayofweekname }} at {{ $json.query.time }} UTC :tada:\\n\\nThis is an excellent meeting for newcomers looking to learn about InnerSource. All are welcome to join!\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"divider\"\n\t\t},\n\t\t{\n\t\t\t\"type\": \"section\",\n\t\t\t\"text\": {\n\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\"text\": \"*This meeting's topic:*\\n\\n{{ $json.query.topic }}\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"divider\"\n\t\t},\n\t\t{\n\t\t\t\"type\": \"section\",\n\t\t\t\"fields\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \":spiral_calendar_pad: *Date:*\\n{{ $json.utcDate.dayofweekname }}, {{ $json.utcDate.monthname}} {{ $json.utcDate.ordinal }}\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\t\"text\": \":alarm_clock: *Time:*\\nMultiple time zones below\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t{\n\t\t\t\"type\": \"section\",\n\t\t\t\"text\": {\n\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\"text\": \"*Time Zones:*\\n• 8:00 AM PST (Pacific Standard Time)\\n• 9:00 AM PDT (Pacific Daylight Time)\\n• 11:00 AM EST (Eastern Standard Time)\\n• 4:00 PM BST (British Summer Time)\\n• 5:00 PM CEST (Central European Summer Time)\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"divider\"\n\t\t},\n\t\t{\n\t\t\t\"type\": \"section\",\n\t\t\t\"text\": {\n\t\t\t\t\"type\": \"mrkdwn\",\n\t\t\t\t\"text\": \":link: <{{ $json.query.meeting_notes_url }}>\\n:link: <https://innersourcecommons.org/calendar/|InnerSource Commons Calendar>\"\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\t\"type\": \"actions\",\n\t\t\t\"elements\": [\n\t\t\t\t{\n\t\t\t\t\t\"type\": \"button\",\n\t\t\t\t\t\"text\": {\n\t\t\t\t\t\t\"type\": \"plain_text\",\n\t\t\t\t\t\t\"text\": \"Join Meeting\",\n\t\t\t\t\t\t\"emoji\": true\n\t\t\t\t\t},\n\t\t\t\t\t\"url\": \"https://us06web.zoom.us/j/84987611486?pwd=Biw6cc9UwWI6FrM51Ugox10sClIP6n.1\",\n\t\t\t\t\t\"style\": \"primary\"\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t]\n}",
        "text": "=",
        "otherOptions": {
          "includeLinkToWorkflow": "={{ false }}",
          "link_names": "={{ false }}",
          "unfurl_links": "={{ false }}",
          "unfurl_media": "={{ false }}"
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1104,
        0
      ],
      "id": "79e4143d-0f41-486a-8847-ed33b9f2bb90",
      "name": "Send a message",
      "webhookId": "a98506f5-5fff-49f7-acfe-9faab97fe78e",
      "credentials": {
        "slackOAuth2Api": {
          "id": "UChla6X5zMTanPIu",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "fe2cbf7e-dcfb-4afa-9797-3a388441e52d",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "prepare-utc-date",
              "name": "utcDate",
              "value": "={{\n  (() => {\n    let dateStr = $json.query.date;\n    let timeStr = $json.query.time;\n    \n    // Extract date part if it includes time\n    if (dateStr.includes('T')) {\n      dateStr = dateStr.split('T')[0];\n    }\n    \n    // Normalize time string to HH:MM:SS format\n    const timeParts = timeStr.split(':');\n    if (timeParts.length === 2) {\n      timeStr = timeStr + ':00';\n    }\n    \n    // Create ISO 8601 UTC datetime string\n    const isoDateTime = dateStr + 'T' + timeStr + 'Z';\n    \n    // Create Date object to extract parts\n    const date = new Date(isoDateTime);\n    \n    // Function to get ordinal suffix\n    const getOrdinal = (n) => {\n      const s = [\"th\", \"st\", \"nd\", \"rd\"];\n      const v = n % 100;\n      return n + (s[(v - 20) % 10] || s[v] || s[0]);\n    };\n    \n    const day = date.getUTCDate();\n    \n    // Return common date parts\n    return {\n      dayofweek: date.getUTCDay(), // 0 (Sunday) to 6 (Saturday)\n      dayofweekname: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][date.getUTCDay()],\n      day: day, // 1-31\n      ordinal: getOrdinal(day), // \"12th\", \"1st\", \"2nd\", etc.\n      month: date.getUTCMonth() + 1, // 1-12 (getUTCMonth returns 0-11)\n      monthname: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'][date.getUTCMonth()],\n      year: date.getUTCFullYear(),\n      hour: date.getUTCHours(),\n      minute: date.getUTCMinutes(),\n      second: date.getUTCSeconds(),\n      isoDateTime: isoDateTime\n    };\n  })()\n}}",
              "type": "object"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        448,
        0
      ],
      "id": "08bae579-9144-466f-a4e9-d4db1adeabc8",
      "name": "Prepare UTC Date"
    },
    {
      "parameters": {
        "path": "ispo-working-group/crier",
        "options": {
          "rawBody": true
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        0,
        192
      ],
      "id": "c709f987-ea88-43d5-a342-1b51a3e485fa",
      "name": "Webhook",
      "webhookId": "0ce14788-827f-4d45-bb3d-b19bac30bfb7"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "date-check",
              "leftValue": "={{ $json.query.date }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            },
            {
              "id": "time-check",
              "leftValue": "={{ $json.query.time }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            },
            {
              "id": "397c8e21-59ce-44b4-8a3d-ec1c26b66cbe",
              "leftValue": "={{ !$json.query.time || !$json.query.date}}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        224,
        96
      ],
      "id": "55ad9ec4-0c8d-47d2-859b-7fb221669872",
      "name": "Validate date and time"
    },
    {
      "parameters": {
        "errorMessage": "Both 'date' and 'time' query parameters are required. Please provide UTC date (e.g., '2024-11-23') and UTC time (e.g., '16:00:00')."
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        448,
        192
      ],
      "id": "742909c4-69e6-4d10-af16-d00b96b79b0a",
      "name": "Stop on error"
    }
  ],
  "pinData": {
    "When clicking ‘Execute workflow’": [
      {
        "json": {
          "query": {
            "date": "2026-01-12",
            "time": "16:00",
            "topic": "What are you working on with InnerSource at your company right now?",
            "channel": "ispo-working-group",
            "meeting_notes_url": "https://docs.google.com/document/d/1wCs68YlWH058GBCwqEyW5UX4hEaGdDKQwYSnLDw0SX8/edit?usp=sharing"
          }
        }
      }
    ]
  },
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Validate date and time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate date and time": {
      "main": [
        [
          {
            "node": "Prepare UTC Date",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Stop on error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare UTC Date": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Validate date and time",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "b857c127-f1af-411b-842b-e5ead0cce1fe",
  "meta": {
    "instanceId": "c8e13a09ffa43327fd701e439b2a9b8e9a88dafc831863b024ea71f9a540b17f"
  },
  "id": "OoKuKHPTjTAImZrt",
  "tags": []
}